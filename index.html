<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recursos Topografía - UADY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/dist/css/all.min.css">
    <script>
        tailwind.config = {
            theme: { extend: { colors: { uadyBlue: '#00468b', uadyGold: '#e3a12f', uadyLightGray: '#f4f4f4' } } }
        }
    </script>
    <style>
        .gradient-uady { background: linear-gradient(135deg, #00468b 0%, #002d5a 100%); }
        .loader { border-top-color: #e3a12f; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-uadyLightGray min-h-screen font-sans">

    <header class="gradient-uady text-white p-6 shadow-lg">
        <div class="container mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center space-x-4">
                <div class="bg-white p-2 rounded shadow-sm">
                    <span class="text-uadyBlue font-extrabold text-xl tracking-tighter">UADY</span>
                </div>
                <div>
                    <h1 class="text-2xl font-bold tracking-tight">Departamento de Topografía</h1>
                    <p class="text-sm text-uadyGold font-medium uppercase tracking-widest">Repositorio de Docencia</p>
                </div>
            </div>
            
            <a href="https://docs.google.com/spreadsheets/d/1vTK4ARbpycnDb1tQG7SN47VfOpBaeY6jDun2N0Y9dAL8l_Dp5V6jV5xVztuTAkR1XNzWauMSzJRxjQG/edit" 
               target="_blank" 
               class="bg-uadyGold hover:bg-yellow-600 text-uadyBlue font-bold py-2 px-6 rounded-full shadow-md transition duration-300 flex items-center">
                <i class="fas fa-pencil-alt mr-2"></i> Gestionar Datos (Excel)
            </a>
        </div>
    </header>

    <main class="container mx-auto p-6">
        <div id="loading" class="flex flex-col items-center justify-center py-24">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-16 w-16 mb-4"></div>
            <p class="text-uadyBlue font-semibold animate-pulse text-center">Sincronizando con la nube... <br> 
               <span class="text-xs font-normal">Si el error persiste en Chrome, por favor usa FIREFOX.</span>
            </p>
        </div>

        <div id="sectionsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 hidden"></div>
    </main>

    <script>
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTK4ARbpycnDb1tQG7SN47VfOpBaeY6jDun2N0Y9dAL8l_Dp5V6jV5xVztuTAkR1XNzWauMSzJRxjQG/pub?output=csv';

        async function loadData() {
            // Se añade un parámetro de tiempo para evitar caché de Google
            const finalUrl = SHEET_URL + '&t=' + new Date().getTime();

            Papa.parse(finalUrl, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    if(results.data && results.data.length > 0) {
                        processData(results.data);
                    } else {
                        showError("La hoja de cálculo parece estar vacía.");
                    }
                },
                error: function(err) {
                    showError("Error de conexión local. Abre este archivo con FIREFOX para saltar las restricciones de Chrome.");
                }
            });
        }

        function processData(data) {
            const grouped = {};
            data.forEach(row => {
                const seccion = row['Seccion'] || row['seccion'];
                const nombre = row['Nombre'] || row['nombre'];
                const link = row['Link'] || row['link'];

                if (seccion && nombre) {
                    if (!grouped[seccion]) grouped[seccion] = [];
                    grouped[seccion].push({ name: nombre, url: link });
                }
            });
            renderUI(grouped);
        }

        function renderUI(groups) {
            const container = document.getElementById('sectionsContainer');
            const loading = document.getElementById('loading');
            container.innerHTML = '';
            
            Object.keys(groups).forEach(title => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'bg-white rounded-2xl shadow-sm border border-gray-100 flex flex-col overflow-hidden';
                const itemsHtml = groups[title].map(item => `
                    <li>
                        <a href="${item.url}" target="_blank" class="flex items-center p-3 rounded-xl hover:bg-blue-50 text-gray-700 font-medium transition">
                            <i class="far fa-file-alt mr-3 text-uadyBlue"></i> ${item.name}
                        </a>
                    </li>
                `).join('');
                sectionDiv.innerHTML = `<div class="bg-uadyBlue p-4 text-white font-bold uppercase text-xs tracking-widest italic">${title}</div><div class="p-5"><ul class="space-y-2">${itemsHtml}</ul></div>`;
                container.appendChild(sectionDiv);
            });
            loading.classList.add('hidden');
            container.classList.remove('hidden');
        }

        function showError(msg) {
            document.getElementById('loading').innerHTML = `<div class="bg-red-50 text-red-600 p-6 rounded-xl border border-red-200 text-center shadow-sm"><i class="fas fa-exclamation-triangle mb-2 text-2xl"></i><br>${msg}</div>`;
        }

        window.onload = loadData;
    </script>
</body>
</html>